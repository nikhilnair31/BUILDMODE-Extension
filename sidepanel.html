<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Related Images</title>
        <style>
            :root { 
                color-scheme: light dark; 
            }
            body { 
                margin: 0; font-family: system-ui, sans-serif; 
            }
            header { 
                position: sticky; top: 0; background: inherit; padding: 12px 14px; border-bottom: 1px solid rgba(0,0,0,.1); z-index: 1; background-color: black; 
            }
            #meta { 
                font-size: 12px; color: #666; margin-top: 4px; word-break: break-word; 
            }
            .card { 
                border: 1px solid rgba(0,0,0,.12); border-radius: 0px; overflow: hidden; 
            }
            .thumb { 
                width: 100%; object-fit: cover; display: block; 
            }
            .caption { 
                font-size: 12px; padding: 8px 10px; color: #444; 
            }
            .empty { 
                padding: 16px; color: #666; text-align: center; 
            }
            button.refresh { 
                padding: 8px 10px; font-size: 13px; cursor: pointer; 
            }
            
            html { scrollbar-gutter: stable; }

            /* add to your existing <style> */
            .thumb[data-placeholder="1"] {
            filter: grayscale(0.1) contrast(0.95);
            }

            /* Masonry layout via CSS columns */
            #grid {
            column-width: 260px;     /* target column width; browser decides count */
            column-gap: 12px;
            padding: 12px;
            }

            /* Each card is a column "brick" */
            .card {
            display: inline-block;   /* needed so items flow inside columns */
            width: 100%;
            margin: 0 0 12px;
            border: 1px solid rgba(0,0,0,.12);
            border-radius: 8px;
            overflow: hidden;
            break-inside: avoid;     /* prevent splits across columns */
            }

            /* Natural-height images (no fixed aspect ratio) */
            .thumb {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover;       /* keeps nice cropping if any intrinsic weirdness */
            cursor: zoom-in;
            }

            /* Optional: responsive tweaks */
            @media (max-width: 900px)  { #grid { column-width: 220px; } }
            @media (max-width: 600px)  { #grid { column-width: 180px; } }

            /* Lightbox */
            .overlay {
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,.7);
                display: none;           /* toggled to flex when opened */
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }
            .overlay.open { 
                display: flex; 
            }

            .lightbox {
                position: relative;
                max-width: 95vw;
                max-height: 90vh;
                outline: 1px solid rgba(255,255,255,.15);
                background: #000;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 10px 40px rgba(0,0,0,.5);
            }
            .lightbox img.fullimg {
                display: block;
                max-width: 95vw;
                max-height: 90vh;
                width: auto;
                height: auto;
                object-fit: contain;
                background: #000;
            }
            .close-btn {
                position: absolute;
                top: 8px;
                right: 8px;
                border: none;
                background: rgba(0,0,0,.6);
                color: #fff;
                font: 600 14px system-ui, sans-serif;
                padding: 8px 10px;
                border-radius: 8px;
                cursor: pointer;
            }
            .close-btn:focus-visible { 
                outline: 2px solid #4da3ff; 
            }
            .thumb { 
                cursor: zoom-in; 
            }
        </style>
    </head>
    <body>
        <header>
            <div><strong>Related Images</strong></div>
            <div id="meta"></div>
        </header>
        <main id="grid"></main>
        <div id="overlay" class="overlay" aria-hidden="true">
            <div class="lightbox" role="dialog" aria-modal="true" aria-label="Image preview">
                <button class="close-btn" id="closeBtn" type="button">Close</button>
                <img class="fullimg" id="fullImg" alt="" />
            </div>
        </div>
        <script type="module" src="sidepanel.js"></script>
    </body>
</html>
